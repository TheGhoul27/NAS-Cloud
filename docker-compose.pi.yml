name: nas-cloud

services:
  nas-cloud:
    image: ${NAS_CLOUD_IMAGE:-ghcr.io/your-org/nas-cloud:latest}
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nas-cloud
    ports:
      - "8000:8000"
    environment:
      DATABASE_URL: sqlite:////data/nas_cloud.db
      NAS_STORAGE_PATH: /data/nas_storage
      FRONTEND_DIST_ROOT: /app/frontend
      CORS_ALLOW_ALL: "true"
      TZ: ${TZ:-UTC}
    volumes:
      - ./data:/data
    healthcheck:
      test: ["CMD-SHELL", "python -c \"import urllib.request; urllib.request.urlopen('http://127.0.0.1:8000/health').read()\""]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 20s
    labels:
      - com.centurylinklabs.watchtower.enable=true
    restart: unless-stopped

  watchtower:
    image: containrrr/watchtower:latest
    container_name: nas-cloud-watchtower
    command: --label-enable --interval 300 --cleanup
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
    profiles:
      - autoupdate